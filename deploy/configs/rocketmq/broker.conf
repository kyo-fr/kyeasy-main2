# ================== 基础配置 ==================
# 所属集群名字，多个 Broker 可以归属到一个集群
brokerClusterName=DefaultCluster

# 当前 Broker 名字，集群内唯一
brokerName=broker-a

# brokerId=0 表示 Master，>0 表示 Slave
brokerId=0

# 指定连接的 NameServer 地址
namesrvAddr=rocketmq:9876

# Broker 对外服务的监听端口（默认 10911）
listenPort=10911

# Broker 对外暴露的 IP 地址（用于客户端连接）
# 宿主机应用通过端口映射访问，使用宿主机地址
# 注意：这里必须填写宿主机能访问的地址，localhost 或宿主机实际 IP
brokerIP1=localhost

# VIP 通道端口（listenPort - 2）
# 对应端口 10909
brokerIP2=localhost


# ================== 日志与存储 ==================
# 消息存储路径（默认 ${ROCKETMQ_HOME}/store）
storePathRootDir=/opt/store

# commitlog 存储路径
storePathCommitLog=/opt/store/commitlog

# 消费队列存储路径
storePathConsumeQueue=/opt/store/consumequeue

# 消息索引存储路径
storePathIndex=/opt/store/index

# 检查点存储路径
storeCheckpoint=/opt/store/checkpoint

# abort 文件存储路径
abortFile=/opt/store/abort


# ================== 清理与保留策略 ==================
# 删除 commitlog 文件的时间点，默认 04 表示凌晨 4 点
deleteWhen=04

# 文件保留时间，单位：小时，默认 72，这里改为 48 小时
fileReservedTime=48

# 磁盘最大使用率，超过此值拒绝接收新消息
# 开发环境设置为 99，基本禁用此检查（生产环境建议 85-90）
diskMaxUsedSpaceRatio=99

# 禁用磁盘空间检查，适用于开发测试环境
# RocketMQ 5.x 在某些环境下磁盘检查有 bug
duplicationEnable=false
diskFallRecorded=false

# ================== 流控配置 ==================
# 禁用 Page Cache 繁忙时的流控（开发环境）
transientStorePoolEnable=false

# 禁用 OS Page Cache 繁忙时拒绝消息
osPageCacheBusyTimeOutMills=0

# 禁用磁盘空间不足时的快速失败
diskSpaceCleanForciblyRatio=0.99


# ================== Broker 角色与刷盘 ==================
# Broker 角色：
# - ASYNC_MASTER：异步复制 Master
# - SYNC_MASTER：同步双写 Master  
# - SLAVE：Slave
brokerRole=ASYNC_MASTER

# 刷盘方式：
# - ASYNC_FLUSH：异步刷盘
# - SYNC_FLUSH：同步刷盘
flushDiskType=ASYNC_FLUSH


# ================== Topic 自动创建配置 ==================
# 是否允许自动创建 Topic
autoCreateTopicEnable=true

# 自动创建 Topic 的默认队列数
defaultTopicQueueNums=4

# 默认 Topic 的读写队列数
defaultTopicReadQueueNums=4
defaultTopicWriteQueueNums=4

# 自动创建订阅组
autoCreateSubscriptionGroup=true


# ================== 性能优化配置 ==================
# 消息存储大小，默认 1G
mappedFileSizeCommitLog=1073741824

# 消费队列存储大小，默认 6M  
mappedFileSizeConsumeQueue=6291456

# 预热映射文件
warmMapedFileEnable=true

# 清理资源间隔，单位：毫秒
cleanResourceInterval=10000

# 删除文件间隔，单位：毫秒
deleteFileInterval=10000

# 刷盘最少页数
flushCommitLogLeastPages=4

# 刷盘最彻底间隔，单位：毫秒
flushCommitLogThoroughInterval=10000

# 消费队列刷盘最少页数
flushConsumeQueueLeastPages=2

# 消费队列刷盘最彻底间隔，单位：毫秒
flushConsumeQueueThoroughInterval=60000


# ================== 网络与超时配置 ==================
# 客户端连接超时时间，单位：毫秒
clientSocketTimeout=30000

# 客户端连接空闲时间，单位：毫秒
clientSocketIdleTimeout=30000

# 服务端连接超时时间，单位：毫秒
serverSocketTimeout=30000

# 服务端连接空闲时间，单位：毫秒
serverSocketIdleTimeout=30000

# 等待 NameServer 响应超时时间，单位：毫秒
waitTimeMillsInSendQueue=3000

# 发送消息超时时间，单位：毫秒
sendMsgTimeout=30000

# 拉取消息超时时间，单位：毫秒
pullMsgTimeout=30000

# 消息最大长度，单位：字节
maxMessageSize=4194304
